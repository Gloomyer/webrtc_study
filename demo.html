<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>WebRtc</title>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
</head>

<body>
    <div class="root">
            <video id="rtc" width="400" height="600" controls autoplay></video>
    </div>
    <script>
        var candidate = new RTCIceCandidate({
            sdpMLineIndex: 1,
        });
        //pc.addIceCandidate(candidate)


        // 判断是否有 navigator.mediaDevices，没有赋成空对象
        if (navigator.mediaDevices === undefined) {
            navigator.mediaDevices = {};
        }

        // 继续判断是否有 navigator.mediaDevices.getUserMedia，没有就采用 navigator.getUserMedia
        if (navigator.mediaDevices.getUserMedia) {
            navigator.mediaDevices.getUserMedia = function (prams) {
                let getUserMedia = navigator.webkitGetUserMedia || navigator.mozGetUserMedia;
                // 兼容获取
                if (!getUserMedia) {
                    return Promise.reject(new Error('getUserMedia is not implemented in this browser'));
                }
                return new Promise(function (resolve, reject) {
                    getUserMedia.call(navigator, prams, resolve, reject);
                });
            };
        }

        navigator.mediaDevices.getUserMedia({ audio: true, video: false })
            .then(stream => {
                let video = document.querySelector('#rtc');
                if (1) { // 判断是否支持 srcObject 属性
                    video.srcObject = stream;
                } else {
                    video.src = window.URL.createObjectURL(stream);
                }
                video.onloadedmetadata = function (e) {
                    video.play();
                };
            })
            .catch(err => { // 捕获错误
                console.error(err);
            })
    </script>
</body>

</html>